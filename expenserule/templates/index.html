{% extends "base.html" %}

{% block title %}Expenses &mdash; ExpenseRule{% endblock %}

{% block content %}
<div class="page-header">
  <hgroup>
    <h2>Expenses</h2>
    <p>All categorized receipts and manual entries</p>
  </hgroup>
  <div class="action-bar">
    <a href="/upload" role="button">Upload Receipt</a>
    <a href="/new" role="button" class="secondary">Manual Entry</a>
    <form method="get" action="/export/csv" class="export-form">
      <select name="year" aria-label="Export year">
        <option value="">All years</option>
        {% for year in years %}
        <option value="{{ year }}">{{ year }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="outline">Export CSV</button>
    </form>
  </div>
</div>

<form
  id="filter-form"
  class="filter-bar"
  hx-get="/expenses/partial"
  hx-trigger="change"
  hx-target="#expense-results"
  hx-swap="innerHTML"
  hx-indicator="#filter-spinner"
>
  <label>
    Category
    <select name="category_filter">
      <option value="">All categories</option>
      {% for cat in categories %}
      <option value="{{ cat.name }}">{{ cat.name }} (Line {{ cat.line }})</option>
      {% endfor %}
    </select>
  </label>

  <div class="filter-divider"></div>

  <label>
    Year
    <select name="year_filter">
      <option value="">All years</option>
      {% for year in years %}
      <option value="{{ year }}">{{ year }}</option>
      {% endfor %}
    </select>
  </label>

  <span id="filter-spinner" class="htmx-indicator text-muted">&#x25CC; filtering&hellip;</span>
</form>

<div id="expense-results">
  {% include "partials/expense_table.html" %}
</div>
{% endblock %}
